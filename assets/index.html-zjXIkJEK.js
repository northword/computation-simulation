import{_ as i}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as l,o as p,c,a as s,b as a,e,d as t}from"./app-1ZTmwhuN.js";const o={},r=t(`<h1 id="pbs" tabindex="-1"><a class="header-anchor" href="#pbs" aria-hidden="true">#</a> PBS</h1><p>作业一般会提交到超算集群上进行计算。在集群上，一般不能随意地直接以 mpirun 运行我们的并行计算程序，而必须通过其上提供的作业管理系统来提交计算任务。集群作业管理系统可以根据用户的需求，统一管理和调度集群的软硬件资源，保证用户作业公平合理地共享集群资源，提高系统利用率和吞吐率。</p><p>PBS 就是其中一种解决方案，作业通过 PBS 命令提交到 PBS 队列中，然后经由 PBS 分配资源运行。</p><h2 id="pbs-命令" tabindex="-1"><a class="header-anchor" href="#pbs-命令" aria-hidden="true">#</a> PBS 命令</h2><h3 id="提交作业" tabindex="-1"><a class="header-anchor" href="#提交作业" aria-hidden="true">#</a> 提交作业</h3><p>用以下命令提交作业：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>qsub <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>control script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>命令执行后会返回一个作业 ID。如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>zjb@op back<span class="token punctuation">]</span>$ qsub <span class="token parameter variable">-N</span> thisIsName vasp.pbs
<span class="token number">201848</span>.inode202
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>作业提交后一般会先排队等待，PBS 系统会根据作业的优先级和可用的计算资源来调度和执行作业。</p><p>其中 <code>-N thisIsName</code> 为选项，它指定了作业的名称。<code>vasp.pbs</code> 为 PBS 脚本，它设定了作业的属性和作业的内容。<code>options</code> 与 <code>control script</code> 详见 PBS 脚本。</p><blockquote><p>文档中，命令带有 \`\` 符号的，表示是在 shell 终端输入的命令，实际输入的时候不需要带有这个符号。</p></blockquote><h3 id="查看任务" tabindex="-1"><a class="header-anchor" href="#查看任务" aria-hidden="true">#</a> 查看任务</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>qstat <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token operator">&lt;</span>jobid<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>zjb@op back<span class="token punctuation">]</span>$ qstat
Job ID                    Name             User            Time Use S Queue
------------------------- ---------------- --------------- -------- - -----
<span class="token number">201848</span>.inode202            thisIsName       zjb             00:00:00 C energy         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中，<code>S</code> 表示任务的状态，有如下几种状态：</p><table><thead><tr><th>状态 (S)</th><th>描述</th></tr></thead><tbody><tr><td>B</td><td>只用于任务向量，表示任务向量已经开始执行</td></tr><tr><td>E</td><td>任务在运行后退出</td></tr><tr><td>H</td><td>任务被服务器或用户或者管理员阻塞</td></tr><tr><td><strong>Q</strong></td><td><strong>任务正在排队中，等待被调度运行</strong></td></tr><tr><td><strong>R</strong></td><td><strong>任务正在运行</strong></td></tr><tr><td><strong>C</strong></td><td><strong>任务完成</strong></td></tr><tr><td>S</td><td>任务被服务器挂起，由于一个更高优先级的任务需要当前任务的资源</td></tr><tr><td>T</td><td>任务被转移到其它执行节点了</td></tr><tr><td>U</td><td>由于服务器繁忙，任务被挂起</td></tr><tr><td>W</td><td>任务在等待它所请求的执行时间的到来 (qsub -a)</td></tr><tr><td>X</td><td>只用于子任务，表示子任务完成</td></tr></tbody></table><h3 id="qstat-的选项" tabindex="-1"><a class="header-anchor" href="#qstat-的选项" aria-hidden="true">#</a> qstat 的选项</h3><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>qstat -q</td><td>列出所有队列</td></tr><tr><td>qstat -a</td><td>列出所有作业</td></tr><tr><td>qstat -u user_id</td><td>列出 user_id 的所有作业</td></tr><tr><td>qstat -r</td><td>列出所有正在运行的作业</td></tr><tr><td>qstat -f job_id</td><td>列出作业 job_id 的信息</td></tr><tr><td>qstat -fQ queue</td><td>列出队列 queue 的信息</td></tr><tr><td>qstat -B</td><td>列出所有作业状态的汇总</td></tr><tr><td>pbsnodes</td><td>列出所有节点的详细信息</td></tr><tr><td>pestat</td><td>列出所有节点的状态</td></tr></tbody></table><h3 id="取消任务" tabindex="-1"><a class="header-anchor" href="#取消任务" aria-hidden="true">#</a> 取消任务</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>qdel <span class="token operator">&lt;</span>jobid<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="停止正在运行的任务" tabindex="-1"><a class="header-anchor" href="#停止正在运行的任务" aria-hidden="true">#</a> 停止正在运行的任务</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>qsig <span class="token parameter variable">-s</span> KILL <span class="token operator">&lt;</span>job ID<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="checkjob" tabindex="-1"><a class="header-anchor" href="#checkjob" aria-hidden="true">#</a> checkjob</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>checkjob <span class="token operator">&lt;</span>job id<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意这儿的 <code>job id</code> 不包括 <code>.inodexxx</code>，比如上述的 <code>201848.inode202</code> 作业，如果使用 <code>checkjob</code> 查询，命令应为 <code>checkjob 201848</code>。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>zjb@op testEnergy<span class="token punctuation">]</span>$ checkjob <span class="token number">201848</span>

checking job <span class="token number">201848</span>

State: Running
Creds:  user:zjb  group:energy  account:SugonClus  class:energy  qos:preemptee
WallTime: 00:02:03 of 00:30:00
SubmitTime: Sat Oct <span class="token number">31</span> <span class="token number">19</span>:45:48
  <span class="token punctuation">(</span>Time Queued  Total: 00:00:01  Eligible: 00:00:01<span class="token punctuation">)</span>

StartTime: Sat Oct <span class="token number">31</span> <span class="token number">19</span>:45:49
Total Tasks: <span class="token number">4</span>

Req<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  TaskCount: <span class="token number">4</span>  Partition: DEFAULT
Network: <span class="token punctuation">[</span>NONE<span class="token punctuation">]</span>  Memory <span class="token operator">&gt;=</span> <span class="token number">0</span>  Disk <span class="token operator">&gt;=</span> <span class="token number">0</span>  Swap <span class="token operator">&gt;=</span> <span class="token number">0</span>
Opsys: <span class="token punctuation">[</span>NONE<span class="token punctuation">]</span>  Arch: <span class="token punctuation">[</span>NONE<span class="token punctuation">]</span>  Features: <span class="token punctuation">[</span>NONE<span class="token punctuation">]</span>
Allocated Nodes:
<span class="token punctuation">[</span>inode53:4<span class="token punctuation">]</span>

IWD: <span class="token punctuation">[</span>NONE<span class="token punctuation">]</span>  Executable:  <span class="token punctuation">[</span>NONE<span class="token punctuation">]</span>
Bypass: <span class="token number">0</span>  StartCount: <span class="token number">1</span>
PartitionMask: <span class="token punctuation">[</span>ALL<span class="token punctuation">]</span>
Flags:       BACKFILL RESTARTABLE PREEMPTEE
Attr:        PREEMPTEE

Reservation <span class="token string">&#39;201868&#39;</span> <span class="token punctuation">(</span>-00:02:04 -<span class="token operator">&gt;</span> 00:27:56  Duration: 00:30:00<span class="token punctuation">)</span>
PE:  <span class="token number">4.00</span>  StartPriority:  <span class="token number">6000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果任务无法运行，可以这样查询原因。</p><h3 id="pbsnodes" tabindex="-1"><a class="header-anchor" href="#pbsnodes" aria-hidden="true">#</a> pbsnodes</h3><p>查看节点的空闲情况。有 <code>free</code>、<code>busy</code>、<code>down</code> 等状态。</p><h2 id="pbs-脚本" tabindex="-1"><a class="header-anchor" href="#pbs-脚本" aria-hidden="true">#</a> PBS 脚本</h2><p>PBS 脚本实际上是一个 linux shell 脚本，在 PBS 脚本中可以用一种特殊形式的注释（#PBS）作为 PBS 指令以设定作业属性。下面是一个 PBS 脚本示例：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token comment">#PBS -N Untitled</span>
<span class="token comment">#PBS -l nodes=1:ppn=4</span>
<span class="token comment">#PBS -l walltime=00:10:00</span>
<span class="token comment">#PBS -j oe</span>
<span class="token comment">#PBS -o ./out.log</span>

<span class="token builtin class-name">cd</span> <span class="token variable">\${PBS_O_WORKDIR}</span>
<span class="token builtin class-name">source</span> /public/software/profile.d/compiler_intel-composer_xe_2015.2.164.sh
<span class="token builtin class-name">source</span> /public/software/profile.d/mpi_intelmpi-5.0.2.044.sh
<span class="token builtin class-name">echo</span> <span class="token string">&quot;=============================================&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Starting VASP run at&quot;</span> <span class="token variable"><span class="token variable">\`</span><span class="token function">date</span><span class="token variable">\`</span></span> 
<span class="token builtin class-name">echo</span> <span class="token string">&quot;=============================================&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;# SYSTEM INFO&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&#39;The hostname is &#39;</span> <span class="token variable"><span class="token variable">\`</span><span class="token function">hostname</span><span class="token variable">\`</span></span>  
<span class="token function">grep</span> <span class="token string">&#39;Linux&#39;</span> /etc/issue 
<span class="token function">grep</span> <span class="token string">&#39;model name&#39;</span> /proc/cpuinfo <span class="token operator">|</span><span class="token function">cut</span> -d: <span class="token parameter variable">-f2</span> <span class="token operator">|</span><span class="token function">uniq</span> <span class="token parameter variable">-c</span>
<span class="token function">grep</span> <span class="token string">&#39;cpu M&#39;</span> /proc/cpuinfo 
<span class="token function">grep</span> <span class="token string">&#39;MemTotal&#39;</span> /proc/meminfo
<span class="token builtin class-name">echo</span> <span class="token string">&quot;=============================================&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;# PBS INFO&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;The PBS_O_WORKDIR is&quot;</span> <span class="token variable">$PBS_O_WORKDIR</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;The PBS_JOBID is&quot;</span> <span class="token variable">$PBS_JOBID</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;The PBS_O_QUEUE is&quot;</span> <span class="token variable">$PBS_O_QUEUE</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;The PBS_O_HOST is&quot;</span> <span class="token variable">$PBS_O_HOST</span>
<span class="token assign-left variable">NP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> $PBS_NODEFILE <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;The num of PBS_NODEFILE is&quot;</span> <span class="token variable">$NP</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;The PBS_NODEFILE IS:&quot;</span> 
<span class="token function">cat</span> <span class="token variable">$PBS_NODEFILE</span>
mpirun <span class="token parameter variable">-np</span> <span class="token variable">$NP</span> <span class="token parameter variable">-machinefile</span> <span class="token variable">$PBS_NODEFILE</span> /public/software//apps/vasp/5.4.1/intelmpi/vasp_std <span class="token operator">&gt;&amp;</span> stdout
<span class="token builtin class-name">echo</span> <span class="token string">&quot;=============================================&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;End task at &quot;</span> <span class="token variable"><span class="token variable">\`</span><span class="token function">date</span><span class="token variable">\`</span></span>  
<span class="token builtin class-name">echo</span> <span class="token string">&quot;=============================================&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pbs-作业属性" tabindex="-1"><a class="header-anchor" href="#pbs-作业属性" aria-hidden="true">#</a> PBS 作业属性</h3><table><thead><tr><th>属性</th><th>取值</th><th>说明</th></tr></thead><tbody><tr><td>-l</td><td>资源列表</td><td>设定作业所需资源，以逗号分隔</td></tr><tr><td>-N</td><td>作业名称</td><td>设定作业的默认名称</td></tr><tr><td>-o</td><td>文件路径</td><td>设定作业的标准输出文件路径</td></tr><tr><td>-e</td><td>文件路径</td><td>设定作业的标准错误文件路径</td></tr><tr><td>-j</td><td>oe 或 eo</td><td>oe: 将标准错误文件与标准输出文件合并成标准输出文件。eo: 将标准错误文件和标准输出文件合并成标准错误文件</td></tr><tr><td>-p</td><td>-1024 到 +1023 之间的整数</td><td>设定作业优先级，越大优先级越高</td></tr><tr><td>-q</td><td>队列名称</td><td>设定作业队列名称</td></tr></tbody></table><h3 id="资源列表" tabindex="-1"><a class="header-anchor" href="#资源列表" aria-hidden="true">#</a> 资源列表</h3><table><thead><tr><th>资源</th><th>取值</th><th>说明</th></tr></thead><tbody><tr><td>nodes</td><td>节点资源构型</td><td>设定作业所需计算节点资源</td></tr><tr><td>walltime</td><td>hh: mm: ss</td><td>设定作业所需的最大 wallclock 时间</td></tr><tr><td>cput</td><td>hh: mm: ss</td><td>设定作业所需的最大 CPU 时间</td></tr><tr><td>mem</td><td>正整数，后面可跟 b，kb，mb，gb</td><td>设定作业所需的最大内存 ncpus 正整数 设定作业所需的 CPU 数目</td></tr></tbody></table><p><strong>指定节点运行：</strong></p><p>有时候某个节点出了问题，但是直接提交仍会被分配到这个节点计算，这时候可以指定一个其他的节点进行提交。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#PBS -l nodes=c72:ppn=16+c73:ppn=16
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>其中，<code>c72</code> 和 <code>c73</code> 是节点名，可以通过 <code>pbsnodes</code> 获取到。</p><p>参考：</p>`,43),d={href:"https://novarizark.github.io/2015/01/24/e3-80-90-e5-b7-b2-e8-a7-a3-e5-86-b3-e3-80-91pbs-e/",target:"_blank",rel:"noopener noreferrer"},u=t(`<h3 id="pbs-常用环境变量" tabindex="-1"><a class="header-anchor" href="#pbs-常用环境变量" aria-hidden="true">#</a> PBS 常用环境变量</h3><table><thead><tr><th>环境变量</th><th>说明</th></tr></thead><tbody><tr><td>PBS_ENVIRONMENT</td><td>批处理作业为 PBS_BATCH，交互式作业为 PBS_INTERACTIVE</td></tr><tr><td>PBS_JOBID PBS</td><td>系统给作业分配的标识号</td></tr><tr><td>PBS_JOBNAME</td><td>用户指定的作业名称</td></tr><tr><td>PBS_NODEFILE</td><td>包含作业所用计算节点的文件名</td></tr><tr><td>PBS_QUEUE</td><td>作业所执行的队列名称</td></tr><tr><td>PBS_O_HOME</td><td>执行 qsub 命令的 HOME 环境变量值</td></tr><tr><td>PBS_O_PATH</td><td>执行 qsub 命令的 PATH 环境变量值</td></tr><tr><td>PBS_O_SHELL</td><td>执行 qsub 命令的 SHELL 环境变量值</td></tr><tr><td>PBS_O_HOST</td><td>执行 qsub 命令节点名称</td></tr><tr><td>PBS_O_QUEUE</td><td>提交的作业的最初队列名称</td></tr><tr><td>PBS_O_WORKDIR</td><td>执行 qsub 命令所在的绝对路径</td></tr></tbody></table><h2 id="高级配置" tabindex="-1"><a class="header-anchor" href="#高级配置" aria-hidden="true">#</a> 高级配置</h2><h3 id="qmgr-查看所有配置" tabindex="-1"><a class="header-anchor" href="#qmgr-查看所有配置" aria-hidden="true">#</a> Qmgr 查看所有配置</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> qmgr <span class="token parameter variable">-c</span> <span class="token string">&quot;p s&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>example:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@compute-0-11 init.d<span class="token punctuation">]</span><span class="token comment"># qmgr</span>
Max <span class="token function">open</span> servers: <span class="token number">49</span>
Qmgr: p s
<span class="token comment">#</span>
<span class="token comment"># Create queues and set their attributes.</span>
<span class="token comment">#</span>
<span class="token comment">#</span>
<span class="token comment"># Create and define queue batch</span>
<span class="token comment">#</span>
create queue batch
<span class="token builtin class-name">set</span> queue batch queue_type <span class="token operator">=</span> Execution
<span class="token builtin class-name">set</span> queue batch acl_host_enable <span class="token operator">=</span> False
<span class="token builtin class-name">set</span> queue batch acl_hosts <span class="token operator">=</span> compute-0-3.local+compute-0-4.local+compute-0-5.local+compute-0-6.local+compute-0-7.local+compute-0-8.local+compute-0-9.local+compute-0-10.local+compute-0-11.local
<span class="token builtin class-name">set</span> queue batch resources_default.walltime <span class="token operator">=</span> <span class="token number">7200</span>:00:00
<span class="token builtin class-name">set</span> queue batch enabled <span class="token operator">=</span> True
<span class="token builtin class-name">set</span> queue batch started <span class="token operator">=</span> True
<span class="token comment">#</span>
<span class="token comment"># Create and define queue gpu</span>
<span class="token comment">#</span>
create queue gpu
<span class="token builtin class-name">set</span> queue gpu queue_type <span class="token operator">=</span> Execution
<span class="token builtin class-name">set</span> queue gpu acl_host_enable <span class="token operator">=</span> False
<span class="token builtin class-name">set</span> queue gpu acl_hosts <span class="token operator">=</span> compute-0-2.local
<span class="token builtin class-name">set</span> queue gpu resources_default.walltime <span class="token operator">=</span> <span class="token number">720</span>:00:00
<span class="token builtin class-name">set</span> queue gpu enabled <span class="token operator">=</span> True
<span class="token builtin class-name">set</span> queue gpu started <span class="token operator">=</span> True
<span class="token comment">#</span>
<span class="token comment"># Set server attributes.</span>
<span class="token comment">#</span>
<span class="token builtin class-name">set</span> server scheduling <span class="token operator">=</span> True
<span class="token builtin class-name">set</span> server default_queue <span class="token operator">=</span> batch
<span class="token builtin class-name">set</span> server query_other_jobs <span class="token operator">=</span> True
<span class="token builtin class-name">set</span> server default_chunk.ncpus <span class="token operator">=</span> <span class="token number">1</span>
<span class="token builtin class-name">set</span> server scheduler_iteration <span class="token operator">=</span> <span class="token number">600</span>
<span class="token builtin class-name">set</span> server resv_enable <span class="token operator">=</span> True
<span class="token builtin class-name">set</span> server node_fail_requeue <span class="token operator">=</span> <span class="token number">310</span>
<span class="token builtin class-name">set</span> server max_array_size <span class="token operator">=</span> <span class="token number">10000</span>
<span class="token builtin class-name">set</span> server pbs_license_min <span class="token operator">=</span> <span class="token number">0</span>
<span class="token builtin class-name">set</span> server pbs_license_max <span class="token operator">=</span> <span class="token number">2147483647</span>
<span class="token builtin class-name">set</span> server pbs_license_linger_time <span class="token operator">=</span> <span class="token number">31536000</span>
<span class="token builtin class-name">set</span> server eligible_time_enable <span class="token operator">=</span> False
<span class="token builtin class-name">set</span> server max_concurrent_provision <span class="token operator">=</span> <span class="token number">5</span>
<span class="token builtin class-name">set</span> server max_job_sequence_id <span class="token operator">=</span> <span class="token number">9999999</span>
Qmgr: 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="普通用户查询他人作业" tabindex="-1"><a class="header-anchor" href="#普通用户查询他人作业" aria-hidden="true">#</a> 普通用户查询他人作业</h3><p>配置使普通用户可以查看其他用户提交的作业（但不能操作）：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>qmgr: <span class="token builtin class-name">set</span> server query_other_jobs <span class="token operator">=</span> True
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>示例：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>scujh_zjb@scu ~<span class="token punctuation">]</span>$ qstat                  <span class="token comment"># 仅能查看自己的任务，查看不到别人的任务</span>
<span class="token punctuation">[</span>scujh_zjb@scu ~<span class="token punctuation">]</span>$ <span class="token function">su</span>
Password: 
<span class="token punctuation">[</span>root@scu /home/scujh_zjb<span class="token punctuation">]</span><span class="token comment"># qmgr</span>
Max <span class="token function">open</span> servers: <span class="token number">49</span>
Qmgr: <span class="token builtin class-name">set</span> server query_other_jobs <span class="token operator">=</span> True
Qmgr: <span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@scu /home/scujh_zjb<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>scujh_zjb@scu ~<span class="token punctuation">]</span>$ qstat

scu: 
                                                            Req<span class="token string">&#39;d  Req&#39;</span>d   Elap
Job ID          Username Queue    Jobname    SessID NDS TSK Memory Time  S Time
--------------- -------- -------- ---------- ------ --- --- ------ ----- - -----
<span class="token number">19</span>.scu          scudt_du gpu      vasp-test-   <span class="token number">1753</span>   <span class="token number">1</span>  <span class="token number">12</span>    --  <span class="token number">720</span>:0 R <span class="token number">69</span>:24
<span class="token number">190</span>.scu         cdu_lsh  batch    <span class="token number">4</span>-CeO2      <span class="token number">10325</span>   <span class="token number">1</span>  <span class="token number">24</span>    --  <span class="token number">72</span>:00 R <span class="token number">18</span>:13
<span class="token number">203</span>.scu         cdu_hg   gpu      <span class="token number">8</span>-OHqy       <span class="token number">8101</span>   <span class="token number">1</span>   <span class="token number">8</span>    --  <span class="token number">24</span>:00 R 00:40
<span class="token number">214</span>.scu         cdu_lsh  batch    2CeO2Ni       --    <span class="token number">1</span>  <span class="token number">24</span>    --  <span class="token number">72</span>:00 Q   -- 
<span class="token punctuation">[</span>scujh_zjb@scu ~<span class="token punctuation">]</span>$ 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考：</p>`,13),m={href:"https://community.openpbs.org/t/pbs-command-to-see-other-users-job-from-user-environment/745",target:"_blank",rel:"noopener noreferrer"},b=t(`<h3 id="解除堆栈大小限制" tabindex="-1"><a class="header-anchor" href="#解除堆栈大小限制" aria-hidden="true">#</a> 解除堆栈大小限制</h3><p>UPDATE in 2022.11.14：该方法未解决该问题。</p><p>用于解决 [分段错误：<code>forrtl: severe (174): SIGSEGV, segmentation fault occurred</code>](../05. VASP/08.%E5%85%B6%E4%BB%96/error. md #forrtl :%20severe%20 (174):%20SIGSEGV,%20segmentation%20fault%20occurred)，为每一个计算节点解除堆栈大小限制。</p><p>在每一个计算节点上，修改 <code>$PBS_EXEC/lib/init.d/limits.pbs_mom</code>（该文件会在运行前被 <code>source</code>）在里面添加 <code>ulimit -s unlimited</code>，然后重启 PBS 服务。</p><p>具体步骤如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">## 依次登录每一个计算节点</span>
<span class="token function">ssh</span> compute-0-11 

<span class="token comment">## 编辑 limits.pbs_mom 文件</span>
<span class="token builtin class-name">cd</span> /opt/pbs/lib/init.d/ <span class="token operator">&amp;&amp;</span> <span class="token function">cp</span> limits.pbs_mom limits.pbs_mom.bak <span class="token operator">&amp;&amp;</span> <span class="token function">vi</span> limits.pbs_mom

<span class="token comment">## 原文件内容：</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/sgi-release <span class="token parameter variable">-o</span> <span class="token parameter variable">-f</span> /etc/sgi-compute-node-release <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">MEMLOCKLIM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
    <span class="token assign-left variable">NOFILESLIM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span><span class="token variable">\`</span></span>
    <span class="token assign-left variable">STACKLIM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-s</span><span class="token variable">\`</span></span>
    <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-l</span> unlimited
    <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span> <span class="token number">16384</span>
    <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-s</span> unlimited
<span class="token keyword">fi</span>

<span class="token comment">## 修改后内容</span>
    <span class="token assign-left variable">MEMLOCKLIM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
    <span class="token assign-left variable">NOFILESLIM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span><span class="token variable">\`</span></span>
    <span class="token assign-left variable">STACKLIM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-s</span><span class="token variable">\`</span></span>
    <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-l</span> unlimited
    <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span> <span class="token number">16384</span>
    <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-s</span> unlimited

<span class="token comment">## 重启 pbs</span>
systemctl restart pbs <span class="token operator">&amp;&amp;</span> systemctl status pbs  <span class="token comment"># 或执行 /etc/init.d/pbs restart</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>日志备份以便理解：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@scu /home/scujh_zjb/test<span class="token punctuation">]</span><span class="token comment"># ssh compute-0-11</span>
Warning: untrusted X11 forwarding setup failed: xauth key data not generated
Last login: Thu Nov <span class="token number">10</span> 03:11:13 <span class="token number">2022</span> from scu
Rocks Compute Node
Rocks <span class="token number">7.0</span> <span class="token punctuation">(</span>Manzanita<span class="token punctuation">)</span>
Profile built <span class="token number">21</span>:21 <span class="token number">20</span>-Oct-2022

Kickstarted <span class="token number">21</span>:27 <span class="token number">20</span>-Oct-2022
<span class="token punctuation">[</span>root@compute-0-11 ~<span class="token punctuation">]</span><span class="token comment"># cd /opt/pbs/lib/init.d/ </span>
<span class="token punctuation">[</span>root@compute-0-11 init.d<span class="token punctuation">]</span><span class="token comment"># ls</span>
limits.pbs_mom         limits.post_services         sgigenvnodelist.awk
limits.pbs_mom.compat  limits.post_services.compat  sgiICEvnode.sh
<span class="token punctuation">[</span>root@compute-0-11 init.d<span class="token punctuation">]</span><span class="token comment"># cd /opt/pbs/lib/init.d/ &amp;&amp; cp limits.pbs_mom limits.pbs_mom.bak &amp;&amp; ls</span>
limits.pbs_mom      limits.pbs_mom.compat  limits.post_services.compat  sgiICEvnode.sh
limits.pbs_mom.bak  limits.post_services   sgigenvnodelist.awk
<span class="token punctuation">[</span>root@compute-0-11 init.d<span class="token punctuation">]</span><span class="token comment"># vi limits.pbs_mom</span>
<span class="token punctuation">[</span>root@compute-0-11 init.d<span class="token punctuation">]</span><span class="token comment"># systemctl restart pbs &amp;&amp; systemctl status pbs</span>
● pbs.service - Portable Batch System
   Loaded: loaded <span class="token punctuation">(</span>/opt/pbs/libexec/pbs_init.d<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Fri <span class="token number">2022</span>-11-11 02:50:13 EST<span class="token punctuation">;</span> 10ms ago
     Docs: man:pbs<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
  Process: <span class="token number">39964</span> <span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/opt/pbs/libexec/pbs_init.d stop <span class="token punctuation">(</span>code<span class="token operator">=</span>exited, <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token number">0</span>/SUCCESS<span class="token punctuation">)</span>
  Process: <span class="token number">40010</span> <span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/opt/pbs/libexec/pbs_init.d start <span class="token punctuation">(</span>code<span class="token operator">=</span>exited, <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token number">0</span>/SUCCESS<span class="token punctuation">)</span>
   Memory: <span class="token number">2</span>.6M
   CGroup: /system.slice/pbs.service
           └─40074 /opt/pbs/sbin/pbs_mom

Nov <span class="token number">11</span> 02:50:12 compute-0-11.local systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting Portable Batch System<span class="token punctuation">..</span>.
Nov <span class="token number">11</span> 02:50:12 compute-0-11.local pbs_init.d<span class="token punctuation">[</span><span class="token number">40010</span><span class="token punctuation">]</span>: Starting PBS
Nov <span class="token number">11</span> 02:50:13 compute-0-11.local pbs_init.d<span class="token punctuation">[</span><span class="token number">40010</span><span class="token punctuation">]</span>: PBS mom
Nov <span class="token number">11</span> 02:50:13 compute-0-11.local systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started Portable Batch System.
<span class="token punctuation">[</span>root@compute-0-11 init.d<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考：</p>`,9),v={href:"https://community.openpbs.org/t/how-to-set-up-stack-size-to-unlimited-in-pbs-pro/235",target:"_blank",rel:"noopener noreferrer"},k={href:"https://community.openpbs.org/t/increasing-the-open-files-limit-across-all-nodes/1361",target:"_blank",rel:"noopener noreferrer"},h={href:"https://phoenixnap.com/kb/ulimit-linux-command",target:"_blank",rel:"noopener noreferrer"};function g(_,S){const n=l("ExternalLinkIcon");return p(),c("div",null,[r,s("ul",null,[s("li",null,[s("a",d,[a("【已解决】pbs指定作业节点 (novarizark.github.io)"),e(n)])])]),u,s("ul",null,[s("li",null,[s("a",m,[a("PBS command to see other users job from user environment - Users/Site Administrators - OpenPBS"),e(n)])])]),b,s("ul",null,[s("li",null,[s("a",v,[a("How to set up stack-size to unlimited in PBS pro - Users/Site Administrators - OpenPBS"),e(n)])]),s("li",null,[s("a",k,[a("Increasing the open files limit across all nodes - Users/Site Administrators - OpenPBS"),e(n)])]),s("li",null,[s("a",h,[a("How to Use the ulimit Linux Command {With Examples} (phoenixnap.com)"),e(n)])])])])}const P=i(o,[["render",g],["__file","index.html.vue"]]);export{P as default};
